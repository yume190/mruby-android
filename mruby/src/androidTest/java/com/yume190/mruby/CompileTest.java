package com.yume190.mruby;


import androidx.test.ext.junit.runners.AndroidJUnit4;

import org.junit.Test;
import org.junit.runner.RunWith;

import static org.junit.Assert.*;

/**
 * Instrumented test, which will execute on an Android device.
 *
 * @see <a href="http://d.android.com/tools/testing">Testing documentation</a>
 */
@RunWith(AndroidJUnit4.class)
public class CompileTest {
//    @Test
//    public void add() {
//        // Context of the app under test.
//
//        Lib lib = new Lib();
//        assertEquals(3, lib.add(1, 2));
//    }

    @Test
    public void complie2() throws Exception {
        // Context of the app under test.

        String code =
            "sensor_value = Tgm.get_sensor(\"07edv0a1\")\n" +
            "if sensor_value > 8\n" +
            "    Tgm.set_sensor(\"05edr001\", 1)\n" +
            "else\n" +
            "    Tgm.set_sensor(\"05edr001\", 0)\n" +
            "end";
        byte[] realBin = new byte[] {
            0x52, 0x49, 0x54, 0x45, 0x30, 0x30, 0x30, 0x36, 0x25, 0x39, 0x00, 0x00, 0x00, (byte)0xAA,
            0x4D, 0x41, 0x54, 0x5A, 0x30, 0x30, 0x30, 0x30, 0x49, 0x52, 0x45, 0x50, 0x00, 0x00, 0x00,
            (byte)0x8C, 0x30, 0x30, 0x30, 0x32, 0x00, 0x00, 0x01, 0x20, 0x00, 0x02, 0x00, 0x06, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x34, 0x1B, 0x02, 0x00, 0x4F, 0x03, 0x00, 0x2E, 0x02, 0x01, 0x01,
            0x01, 0x01, 0x02, 0x03, 0x03, 0x08, 0x44, 0x02, 0x23, 0x02, 0x00, 0x25, 0x1B, 0x02, 0x00,
            0x4F, 0x03, 0x01, 0x07, 0x04, 0x2E, 0x02, 0x02, 0x02, 0x21, 0x00, 0x31, 0x1B, 0x02, 0x00,
            0x4F, 0x03, 0x01, 0x06, 0x04, 0x2E, 0x02, 0x02, 0x02, 0x37, 0x02, 0x67, 0x00, 0x00, 0x00,
            0x02, 0x00, 0x00, 0x08, 0x30, 0x37, 0x65, 0x64, 0x76, 0x30, 0x61, 0x31, 0x00, 0x00, 0x08,
            0x30, 0x35, 0x65, 0x64, 0x72, 0x30, 0x30, 0x31, 0x00, 0x00, 0x00, 0x03, 0x00, 0x03, 0x54,
            0x67, 0x6D, 0x00, 0x00, 0x0A, 0x67, 0x65, 0x74, 0x5F, 0x73, 0x65, 0x6E, 0x73, 0x6F, 0x72,
            0x00, 0x00, 0x0A, 0x73, 0x65, 0x74, 0x5F, 0x73, 0x65, 0x6E, 0x73, 0x6F, 0x72, 0x00, 0x45,
            0x4E, 0x44, 0x00, 0x00, 0x00, 0x00, 0x08
        };

        byte[] compiled_remove_lv = MRuby.compile(code, true);
        byte[] compiled_lv = MRuby.compile(code, false);
        assertEquals(170, compiled_remove_lv.length);
        assertArrayEquals(realBin, compiled_remove_lv);
        assertEquals(200, compiled_lv.length);
    }

    @Test
    public void complie3() throws Exception {
        // Context of the app under test.
        String code =
            "sensor_value_01 = Tgm.get_sensor(\"07edv0a2\")\n" +
            "if sensor_value_01 > 5\n" +
            "    Tgm.set_sensor(\"05edr002\", 1)\n" +
            "else\n" +
            "    Tgm.set_sensor(\"05edr002\", 0)\n" +
            "end";

        byte[] compiled_remove_lv = MRuby.compile(code, true);
        byte[] compiled_lv = MRuby.compile(code, false);
        assertEquals(169, compiled_remove_lv.length);
        assertEquals(202, compiled_lv.length);
    }
}

